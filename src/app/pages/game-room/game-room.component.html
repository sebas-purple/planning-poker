<div class="game-container">
  <header class="header">
    <a-typography [text]="textHeader"></a-typography>
  </header>

  <div class="content">
    <div class="table-container">
      <!-- <a-table></a-table> -->
      <div class="table">
        <ng-container *ngIf="isButtonRevealCardsVisible()">
          <a-button
            *ngIf="!isRevealed"
            [text]="textButtonRevealCards"
            [type]="typeButtonRevealCards"
            (click)="revealCards()"
          ></a-button>

          <!-- Botón Nueva votación solo visible si las cartas están reveladas -->
          <a-button
            *ngIf="isRevealed"
            [text]="textButtonNewVoting"
            [type]="typeButtonRevealCards"
            (click)="startNewVoting()"
          ></a-button>
        </ng-container>
      </div>
      <div class="players-container">
        <div class="player-slot" *ngFor="let player of players">
          <ng-container
            *ngIf="player.viewMode === 'espectador'; else playerView"
          >
            <m-card-label
              [text]="player.name.slice(0, 2).toUpperCase()"
              [cardtype]="'viewer'"
              [labelText]="player.name"
              [labelType]="'small'"
              class="player-card"
            ></m-card-label>
          </ng-container>
          <ng-template #playerView>
            <!-- solo pasar el texto si isRevealed es true -->
            <m-card-label
              [cardtype]="'player'"
              [labelText]="player.name"
              [labelType]="'small'"
              [isSelected]="gameService.hasPlayerSelectedCard(player.id)"
              [isRevealed]="isRevealed"
              [text]="
                isRevealed
                  ? gameService.getPlayerSelectedCard(player.id) || ''
                  : ''
              "
              class="player-card"
            ></m-card-label>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <!-- Mostrar selección de cartas solo para jugadores y cuando no están reveladas -->
    <ng-container
      *ngIf="userService.getCurrentUser?.viewMode === 'jugador' && !isRevealed"
    >
      <a-typography [type]="textFooterType" [text]="textFooter"></a-typography>
      <div class="footer-options">
        <a-card
          type="choice"
          *ngFor="let card of cards"
          [text]="card.text"
          [isSelected]="
            gameService.getPlayerSelectedCard(
              userService.getCurrentUser?.id || ''
            ) === card.id
          "
          (cardClick)="onCardSelected(card.id, $event)"
          [isClickable]="true"
        ></a-card>
      </div>
    </ng-container>

    <!-- Mostrar estadísticas cuando las cartas están reveladas -->
    <ng-container *ngIf="isRevealed">
      <div class="statistics">
        <!-- Conteo de votos por carta -->
        <div class="votes-count">
          <ng-container *ngFor="let vote of getVotesCountArray()">
            <div class="vote-item">
              <m-card-label
                [text]="vote.value"
                [cardtype]="'choice'"
                [labelText]="
                  vote.count + (vote.count === 1 ? ' voto' : ' votos')
                "
                [labelType]="'small'"
                [isRevealed]="true"
                [isClickable]="false"
              ></m-card-label>
            </div>
          </ng-container>
        </div>

        <!-- Promedio -->
        <div class="average" *ngIf="getAverageScore() > 0">
          <span>Promedio:</span>
          <span class="average-value">{{ getAverageScore() }}</span>
        </div>
      </div>
    </ng-container>
  </div>
</div>

<!-- <div class="overlay" *ngIf="!userService.getCurrentUser">
  <o-create-user
    [textLabel]="textLabel"
    [textLabeljugador]="textLabeljugador"
    [textLabelespectador]="textLabelespectador"
    [textButton]="textButton"
    [labelType]="labelType"
    [jugador]="jugador"
    [espectador]="espectador"
    (formSubmit)="handleCreateUser($event)"
  ></o-create-user>
</div> -->

<!-- 
<o-create-user
  [textLabel]="textLabel"
  [textLabeljugador]="textLabeljugador"
  [textLabelespectador]="textLabelespectador"
  [textButton]="textButton"
  [labelType]="labelType"
  [jugador]="jugador"
  [espectador]="espectador"
  [showDialog]="!userService.getCurrentUser"
  (formSubmit)="handleCreateUser($event)"
></o-create-use -->

<app-game-room-create-user></app-game-room-create-user>
